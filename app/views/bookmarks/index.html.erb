<div class="container">
  <div class="mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <h1>ブックマーク一覧</h1>
      <%= link_to '新規ブックマーク追加', new_bookmark_path, class: 'btn btn-success' %>
    </div>

    <% if @tags.any? %>
      <div class="mt-3">
        <h5>タグで絞り込む</h5>
        <div class="d-flex flex-wrap gap-2">
          <% @tags.each do |tag| %>
            <%= link_to tag.name, 
                bookmarks_path(tag_name: tag.name), 
                class: "badge bg-#{params[:tag_name] == tag.name ? 'primary' : 'secondary'} text-decoration-none" %>
          <% end %>
          <% if params[:tag_name].present? %>
            <%= link_to '絞り込み解除', bookmarks_path, class: 'badge bg-danger text-decoration-none' %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>お気に入り</th>
          <th>URL</th>
          <th>タイトル</th>
          <th>ステータス</th>
          <th>タグ</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <% @bookmarks.each do |bookmark| %>
          <tr>
            <!-- お気に入りアイコン -->
            <td>
              <%= button_to bookmark.favorite ? '★' : '☆', 
                  toggle_favorite_bookmark_path(bookmark), 
                  method: :patch, 
                  class: "btn btn-link p-0 text-warning", 
                  remote: true 
              %>
            </td>
            <td><%= link_to bookmark.url, bookmark.url, target: "_blank" %></td>
            <td><%= bookmark.title %></td>
            <td>
              <span class="badge bg-<%= bookmark.status == '未読' ? 'warning text-dark' : 'success' %>">
                <%= bookmark.status %>
              </span>
            </td>
            <td>
              <% bookmark.tags.each do |tag| %>
                <span class="badge bg-secondary"><%= tag.name %></span>
              <% end %>
            </td>
            <td>
              <%= link_to '詳細', bookmark_path(bookmark), class: 'btn btn-info btn-sm' %>
              <%= link_to '編集', edit_bookmark_path(bookmark), class: 'btn btn-warning btn-sm' %>
              <%= link_to '削除', 
                  bookmark_path(bookmark),
                  class: 'btn btn-danger btn-sm',
                  data: { 
                    turbo_method: :delete,
                    turbo_confirm: '削除してもよろしいですか？'
                  }
              %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= paginate @bookmarks %>
</div>
